Author: Emilio Pozuelo Monfort <pochu@debian.org>

Even if logind is running (which is what haveSystemd() is checking), it may
fail to create a session, e.g. if the kernel doesn't have cgroups support.

If that's the case, XDG_SESSION_ID will not be set and we will fail to
start. Thus talk to logind if XDG_SESSION_ID is set, which is a sign that
logind actually created our session. Otherwise, fall back to ConsoleKit.

http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=729877

Index: gnome-shell-3.16.2/js/misc/loginManager.js
===================================================================
--- gnome-shell-3.16.2.orig/js/misc/loginManager.js	2015-06-15 20:46:24.805673265 +0200
+++ gnome-shell-3.16.2/js/misc/loginManager.js	2015-06-15 20:46:24.801673346 +0200
@@ -90,7 +90,7 @@
  */
 function getLoginManager() {
     if (_loginManager == null) {
-        if (haveSystemd())
+        if (haveSystemd() && GLib.getenv('XDG_SESSION_ID'))
             _loginManager = new LoginManagerSystemd();
         else
             _loginManager = new LoginManagerDummy();
